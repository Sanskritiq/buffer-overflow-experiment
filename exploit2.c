#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define BUFFER_SIZE 10

void exploitable(char *arg)
{
    char buffer[BUFFER_SIZE];
    size_t length = strnlen(arg, BUFFER_SIZE); // Use safer strnlen
    memcpy(buffer, arg, length);
    buffer[length] = '\0'; // Ensure null-terminated
    printf("The buffer says .. [%s/%p].\n", buffer, &buffer);
}

int main(int argc, char **argv)
{
    char exploit[BUFFER_SIZE + sizeof(void *)]; // Adjust size to fit address
    memset(exploit, 0x41, BUFFER_SIZE);

    // Overwrite the return address with the address of main in sanskriti.c
    // Use the correct address of the main function
    void (*sanskriti_main_ptr)() = (void (*)())0x11a9;

    // Adjust for endianness
    for (int i = 0; i < sizeof(void *); ++i)
    {
        exploit[BUFFER_SIZE + i] = ((char *)&sanskriti_main_ptr)[i];
    }

    exploitable(exploit);
    return 0;
}
